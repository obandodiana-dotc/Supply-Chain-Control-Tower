<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>SupplyChain Intelligence · Risk Dashboard</title>

<style>
  :root {
    --bg: #0a0f1c;
    --card: #131b2f;
    --soft: #1c2640;
    --accent: #38bdf8;
    --accent2: #34d399;
    --warn: #facc15;
    --danger: #fb7185;
    --text: #e2e8f0;
    --text-soft: #94a3b8;
    --radius: 18px;
    --radius-sm: 10px;
    --font: system-ui, sans-serif;
  }

  * { margin:0; padding:0; box-sizing:border-box; font-family:var(--font); }
  body {
    background: var(--bg);
    color: var(--text);
    padding-bottom: 50px;
  }

  nav {
    width: 100%;
    background: var(--card);
    padding: 14px;
    display: flex;
    justify-content: center;
    gap: 22px;
    position: sticky;
    top: 0;
    z-index: 99;
    border-bottom: 1px solid #1e293b;
  }
  nav a {
    color: var(--text-soft);
    text-decoration: none;
    font-weight: 500;
  }
  nav a:hover { color: var(--accent); }

  .container {
    max-width: 960px;
    margin: auto;
    padding: 20px;
  }

  h1 {
    text-align: center;
    font-size: 32px;
    margin-bottom: 6px;
    background: linear-gradient(to right, #38bdf8, #a855f7, #f97316);
    -webkit-background-clip: text;
    color: transparent;
  }
  .subtitle {
    text-align:center;
    font-size:14px;
    color:var(--text-soft);
    margin-bottom:20px;
  }

  .card {
    background: var(--card);
    padding: 16px;
    border-radius: var(--radius);
    border: 1px solid #1e293b;
    margin-top: 26px;
  }

  .card-title {
    font-size:18px;
    margin-bottom:12px;
    font-weight:600;
  }

  .kpi {
    background: var(--soft);
    padding:16px;
    border-radius:var(--radius-sm);
    border:1px solid #24314d;
    margin-top:14px;
  }

  .kpi-value {
    font-size:32px;
    font-weight:700;
  }

  .tag {
    padding:4px 10px;
    border-radius:999px;
    width:fit-content;
    font-size:12px;
    margin-top:8px;
  }
  .green { background:rgba(34,197,94,0.15); color:#bbf7d0; }
  .yellow { background:rgba(250,204,21,0.15); color:#fef9c3; }
  .red { background:rgba(248,113,113,0.15); color:#fee2e2; }

  .grid-2 {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 16px;
  }

  @media(max-width:700px){
    .grid-2 { grid-template-columns:1fr; }
  }

  .node-box {
    background: var(--soft);
    padding:14px;
    border-radius:var(--radius-sm);
    border:1px solid #24314d;
  }
  .node-name {
    font-size:16px;
    font-weight:600;
  }

  .insights {
    font-size:14px;
    color:var(--text-soft);
    margin-top:10px;
    line-height:1.6;
  }
</style>

</head>

<body>

<!-- NAV -->
<nav>
  <a href="index.html">Dashboard</a>
  <a href="inventory.html">Inventory</a>
  <a href="map.html">Network Map</a>
  <a href="simulation.html">Simulation</a>
  <a href="risk.html">Risk</a>
  <a href="abc.html">ABC</a>
</nav>

<div class="container">

  <h1>Risk Dashboard</h1>
  <p class="subtitle">Integrated operational, financial and network exposure</p>

  <!-- GLOBAL RISK SCORE -->
  <div class="card">
    <div class="card-title">Overall Supply Chain Risk</div>

    <div class="kpi" id="globalRiskCard">
      <div class="kpi-value" id="globalRiskValue">--</div>
      <div id="globalRiskTag" class="tag"></div>
    </div>
  </div>

  <!-- CATEGORY RISK -->
  <div class="card">
    <div class="card-title">Risk Dimensions</div>

    <div class="grid-2">

      <div class="node-box">
        <div class="node-name">Operational Risk</div>
        <div id="opRiskValue" class="kpi-value">--</div>
        <div id="opRiskTag" class="tag"></div>
      </div>

      <div class="node-box">
        <div class="node-name">Financial Risk</div>
        <div id="finRiskValue" class="kpi-value">--</div>
        <div id="finRiskTag" class="tag"></div>
      </div>

      <div class="node-box">
        <div class="node-name">Network Risk</div>
        <div id="netRiskValue" class="kpi-value">--</div>
        <div id="netRiskTag" class="tag"></div>
      </div>

      <div class="node-box">
        <div class="node-name">Demand Variability Risk</div>
        <div id="varRiskValue" class="kpi-value">--</div>
        <div id="varRiskTag" class="tag"></div>
      </div>

    </div>
  </div>

  <!-- INSIGHTS -->
  <div class="card">
    <div class="card-title">Insights & Commentary</div>
    <div id="insightBox" class="insights"></div>
  </div>

</div>

<script src="data.js"></script>

<script>
/* ============================================================
   HELPERS
   ============================================================ */
function tagColor(score) {
  if (score < 30) return "green";
  if (score < 60) return "yellow";
  return "red";
}
function tagLabel(score) {
  if (score < 30) return "LOW";
  if (score < 60) return "MEDIUM";
  return "HIGH";
}

/* ============================================================
   MAIN RISK ENGINE
   ============================================================ */
function calculateRisk() {

  /* ----- NETWORK RISK (from nodes) ----- */
  const netRisks = Object.values(NetworkNodes).map(n => n.risk);
  const networkRisk = (netRisks.reduce((a,b)=>a+b,0) / netRisks.length) * 100;

  /* ----- VARIABILITY RISK (from SKUs) ----- */
  const stdList = SKUs.map(s => s.demandStd);
  const avgStd = stdList.reduce((a,b)=>a+b) / stdList.length;
  const varRisk = Math.min(100, avgStd * 10); // scaled

  /* ----- FINANCIAL RISK (value-weighted inventory costs) ----- */
  const portfolioValue = SKUs.reduce((sum, s) => sum + s.unitCost * s.demandAnnual, 0);
  const finRisk = Math.min(100, portfolioValue / 50000); // scaled

  /* ----- OPERATIONAL RISK (LT + variability + replenishment complexity) ----- */
  const avgLT = SKUs.reduce((sum, s) => sum + s.leadTime, 0) / SKUs.length;
  const opRisk = Math.min(100, (avgLT * 3) + varRisk * 0.3);

  /* ----- GLOBAL RISK (weighted) ----- */
  const globalRisk = (
    opRisk * 0.35 +
    finRisk * 0.20 +
    networkRisk * 0.30 +
    varRisk * 0.15
  );

  return {
    globalRisk,
    networkRisk,
    varRisk,
    finRisk,
    opRisk
  };
}

/* ============================================================
   RENDER PAGE
   ============================================================ */
function render() {
  const r = calculateRisk();

  /* Global Risk */
  document.getElementById("globalRiskValue").textContent = r.globalRisk.toFixed(0);
  document.getElementById("globalRiskTag").textContent = tagLabel(r.globalRisk);
  document.getElementById("globalRiskTag").classList.add(tagColor(r.globalRisk));

  /* Operational */
  document.getElementById("opRiskValue").textContent = r.opRisk.toFixed(0);
  document.getElementById("opRiskTag").textContent = tagLabel(r.opRisk);
  document.getElementById("opRiskTag").classList.add(tagColor(r.opRisk));

  /* Financial */
  document.getElementById("finRiskValue").textContent = r.finRisk.toFixed(0);
  document.getElementById("finRiskTag").textContent = tagLabel(r.finRisk);
  document.getElementById("finRiskTag").classList.add(tagColor(r.finRisk));

  /* Network */
  document.getElementById("netRiskValue").textContent = r.networkRisk.toFixed(0);
  document.getElementById("netRiskTag").textContent = tagLabel(r.networkRisk);
  document.getElementById("netRiskTag").classList.add(tagColor(r.networkRisk));

  /* Variability */
  document.getElementById("varRiskValue").textContent = r.varRisk.toFixed(0);
  document.getElementById("varRiskTag").textContent = tagLabel(r.varRisk);
  document.getElementById("varRiskTag").classList.add(tagColor(r.varRisk));

  /* Insights */
  document.getElementById("insightBox").innerHTML = `
    • The global supply chain risk is currently classified as <strong>${tagLabel(r.globalRisk)}</strong>.<br><br>
    • Network exposure is at <strong>${r.networkRisk.toFixed(0)}%</strong>, driven mainly by factory and DC instability.<br><br>
    • Demand variability contributes <strong>${r.varRisk.toFixed(0)}%</strong> to the overall risk profile.<br><br>
    • The estimated financial exposure of the portfolio indicates a medium-to-high sensitivity to stockouts.<br><br>
    • Operational risk remains elevated due to extended lead times across several SKU categories.
  `;
}

/* START APP */
render();
</script>

</body>
</html>
